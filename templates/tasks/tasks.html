{% extends 'task_manager/layout.html' %}
{% load i18n %}
{% block content %}
<div class="container">
  <div class="form-group m-4 ml-auto">
    <a href="{% url 'tasks:task_create' %}" class="btn btn-outline-dark">{% trans "Создать задачу" %}</a>
  </div>
  <table class="table table-hover">
    <form method="get">
        <div class="form-row mb-3">
            <div class="col">
                <div id="label-pills">
                    {% for label in labels %}
                        <button type="button" class="btn btn-sm btn-outline-dark btn-pill rounded-pill my-1"
                                data-label-id="{{ label.id }}">
                            {{ label.name }}</button>
                    {% endfor %}
                </div>
                <!-- Скрытое поле для хранения выбранных меток -->
                <input type="hidden" name="label" id="selected-labels" value="{{ request.GET.label }}">
            </div>
        </div>
        <thead class="bg-light">
            <tr>
                <th>
                    ID
                </th>
                <th>
                    <input type="text" class="form-control form-control-sm" placeholder="{% trans 'Имя задачи' %}" name="name" value="{{ request.GET.name }}">
                </th>
                <th>
                    <select class="form-control form-control-sm" name="status" id="id_status">
                        <option selected></option>
                        {% for status in statuses %}
                            <option value="{{ status.id }}" {% if request.GET.status == status.id|stringformat:"s" %}selected{% endif %}>{{ status.name }}</option>
                        {% endfor %}
                    </select>
                </th>
                <th>
                    Автор
                </th>
                <th>
                    <select class="form-control form-control-sm" name="executor" id="id_executor">
                        <option selected></option>
                        {% for user in users %}
                            {% if user.username %}
                                <option value="{{ user.id }}" {% if request.GET.executor == user.id|stringformat:"s" %}selected{% endif %}>{{ user.get_full_name|default:user.username }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </th>
                <th>
                    Дата создания
                </th>
                <th>
                    <button type="submit" class="btn btn-outline-dark btn-sm">{% trans "Фильтровать" %}</button>
                </th>
            </tr>
        </thead>
    </form>

    <tbody>
      {% for task in tasks %}
        <tr>
          <td>{{ task.id }}</td>
          <td><a href="{% url 'tasks:task_detail' task.id %}">{{ task.name }}</a></td>
          <td>{{ task.status }}</td>
          <td>{{ task.author.get_full_name|default:task.author.username }}</td>
          <td>{{ task.executor.get_full_name|default:task.executor.username }}</td>
          <td>{{ task.created_at|date:"d.m.Y H:i" }}</td>
          <td>
            <div class="btn-group" role="group" aria-label="Действия">
              <a href="{% url 'tasks:task_update' task.id %}" class="btn btn-link">
                <i class="bi bi-pencil text-secondary"></i>
              </a>
              <a href="{% url 'tasks:task_delete' task.id %}" class="btn btn-link">
                <i class="bi bi-trash text-secondary"></i>
              </a>
            </div>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="7">{% trans "Нет задач." %}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<div class="mb-5"></div>
{% endblock %}